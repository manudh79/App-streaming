<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>KALAL_Y Live</title>

<style>
    body, html {
        margin: 0;
        padding: 0;
        background: black;
        overflow: hidden;
        font-family: sans-serif;
        color: white;
    }

    #video {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        z-index: 1;
    }

    /* ============================
       TOP LEFT USER + VIEWERS
       ============================ */
    #userBox {
        position: fixed;
        top: 60px;
        left: 20px;
        z-index: 5;
    }

    #userRow {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    #kalalIcon {
        height: 32px;
    }

    #userName {
        font-size: 26px;
        font-weight: 600;
    }

    #viewersRow {
        margin-top: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    #eyeIcon {
        height: 24px;
    }

    #viewersText {
        font-size: 20px;
        opacity: 0.9;
    }

    /* ============================
       LIVE STREAMING BADGE
       ============================ */
    #liveBadge {
        position: fixed;
        top: 60px;
        right: 20px;
        background: #c62828;
        padding: 10px 22px;
        border-radius: 18px;
        font-size: 18px;
        font-weight: 600;
        display: none;
        z-index: 5;
    }

    /* ============================
       COMMENTS BOTTOM LEFT
       ============================ */
    #commentsBox {
        position: fixed;
        bottom: 150px;
        left: 20px;
        width: 80%;
        display: flex;
        flex-direction: column-reverse;
        gap: 10px;
        z-index: 5;
        font-size: 20px;
        line-height: 22px;
    }

    /* ============================
       BOTTOM ICONS (NO CIRCLES)
       ============================ */
    #bottomBar {
        position: fixed;
        bottom: 40px;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 70px;
        z-index: 5;
    }

    .iconBtn {
        background: none;
        border: none;
        padding: 0;
    }

    .iconImg {
        height: 52px;  /* Ajuste perfecto para tu dise√±o */
    }

</style>
</head>

<body>

<!-- VIDEO -->
<video id="video" autoplay playsinline muted></video>

<!-- USER + VIEWERS -->
<div id="userBox">
    <div id="userRow">
        <img id="kalalIcon" src="icons/KALAL.png">
        <div id="userName">KALAL_Y</div>
    </div>

    <div id="viewersRow">
        <img id="eyeIcon" src="icons/OJO VIEWERS.png">
        <div id="viewersText">50,604 viewers</div>
    </div>
</div>

<!-- LIVE -->
<div id="liveBadge">LIVE STREAMING</div>

<!-- COMMENTS -->
<div id="commentsBox"></div>

<!-- BOTTOM BUTTONS -->
<div id="bottomBar">
    <button id="recBtn" class="iconBtn">
        <img class="iconImg" src="icons/REC.png">
    </button>

    <button id="camBtn" class="iconBtn">
        <img class="iconImg" src="icons/CAMBIO C√ÅMARA.png">
    </button>

    <button id="likeBtn" class="iconBtn">
        <img class="iconImg" src="icons/CORAZ√ìN.png">
    </button>
</div>

<script>
/* ==========================================================
   CAMERA INITIALIZATION
   ========================================================== */
let usingFront = false;
let stream = null;
let recorder = null;
let chunks = [];

/* DOM */
const video = document.getElementById("video");
const commentsBox = document.getElementById("commentsBox");
const liveBadge = document.getElementById("liveBadge");
const viewersText = document.getElementById("viewersText");

/* ==========================================================
   START CAMERA
   ========================================================== */
async function startCamera() {
    if (stream) stream.getTracks().forEach(t => t.stop());

    stream = await navigator.mediaDevices.getUserMedia({
        video: {
            facingMode: usingFront ? "user" : "environment",
            width: { ideal: 1920 },
            height: { ideal: 1080 }
        },
        audio: {
            echoCancellation: true,
            noiseSuppression: true
        }
    });

    video.srcObject = stream;
}
startCamera();

/* CAMERA SWITCH */
document.getElementById("camBtn").onclick = () => {
    usingFront = !usingFront;
    startCamera();
};

/* ==========================================================
   VIEWERS INCREASING
   ========================================================== */
let viewers = 50604;
setInterval(() => {
    viewers = Math.floor(viewers * 1.015);
    viewersText.textContent = viewers.toLocaleString() + " viewers";
}, 2000);


/* ==========================================================
   COMMENTS SYSTEM (BOTTOM LEFT)
   ========================================================== */

const arabicNames = [
    "ŸÅŸáÿØ", "ÿ≥ŸäŸÅ", "ŸÉÿ±ŸäŸÖ", "ŸÜŸàÿ±", "ŸÖÿ±ŸàÿßŸÜ", "ÿ¢ÿØŸÖ",
    "ŸÑŸäŸÑŸâ", "ÿ≥ÿßÿ±ÿ©", "ÿπŸÑŸä", "Ÿäÿßÿ≥ŸäŸÜ"
];

const arabicMsgs = [
    "ÿ¨ŸäÿØ ÿ¨ÿØŸãÿß üëç",
    "üî•üî• ÿßÿ≥ÿ™ŸÖÿ±",
    "ÿ£ÿØÿßÿ° ŸÖŸÖÿ™ÿßÿ≤ üëç",
    "ÿ£ŸÜÿ™ ÿ±ÿßÿ¶ÿπ üî•",
    "ÿßÿ≥ÿ™ŸÖÿ± Ÿäÿß ÿ®ÿ∑ŸÑ üëç"
];

function addComment() {
    const name = arabicNames[Math.floor(Math.random() * arabicNames.length)];
    const msg = arabicMsgs[Math.floor(Math.random() * arabicMsgs.length)];

    const div = document.createElement("div");
    div.textContent = `${name}: ${msg}`;
    commentsBox.appendChild(div);

    if (commentsBox.children.length > 5) {
        commentsBox.removeChild(commentsBox.children[0]);
    }
}

setInterval(addComment, 1600);


/* ==========================================================
   RECORDING + LIVE BLINK
   ========================================================== */

let recording = false;
let blinkState = true;

document.getElementById("recBtn").onclick = () => {
    if (!recording) startRecording();
    else stopRecording();
};

function startRecording() {
    chunks = [];
    const canvas = new OffscreenCanvas(video.videoWidth, video.videoHeight);
    const ctx = canvas.getContext("2d");

    function draw() {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        requestAnimationFrame(draw);
    }
    draw();

    const streamCanvas = canvas.captureStream(30);

    recorder = new MediaRecorder(streamCanvas, { mimeType: "video/webm" });
    recorder.ondataavailable = e => { if (e.data.size > 0) chunks.push(e.data); };

    recorder.onstop = () => {
        const blob = new Blob(chunks, { type: "video/webm" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "live.mp4";
        a.click();
        URL.revokeObjectURL(url);
    };

    recorder.start();
    recording = true;
    blinkLive();
}

function stopRecording() {
    recording = false;
    liveBadge.style.display = "none";
    recorder.stop();
}

function blinkLive() {
    if (!recording) return;
    liveBadge.style.display = blinkState ? "block" : "none";
    blinkState = !blinkState;
    setTimeout(blinkLive, 600);
}

</script>
</body>
</html>
