<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KALAL_Y LIVE</title>

<style>
    body, html {
        margin: 0;
        padding: 0;
        background: black;
        overflow: hidden;
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        color: white;
    }

    /* VIDEO */
    #video {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        z-index: 1;
    }

    /* TOP USER AREA */
    #topBox {
        position: fixed;
        top: 35px;     /* Ajustado EXACTO a tu maqueta */
        left: 20px;
        z-index: 5;
    }
    #userRow {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    #kalalIcon {
        height: 32px;     /* MÃ¡s grande, como tu ejemplo */
    }
    #userName {
        font-size: 22px;  /* MÃ¡s pequeÃ±o, como pediste */
        font-weight: 600;
    }

    /* VIEWERS ROW */
    #viewersRow {
        margin-top: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
        opacity: 0.95;
    }
    #eyeIcon {
        height: 22px;
    }
    #viewersText {
        font-size: 20px;
    }

    /* LIVE BADGE */
    #liveBadge {
        position: fixed;
        top: 35px;
        right: 20px;
        background: #C62828;
        padding: 8px 20px;
        border-radius: 16px;
        font-size: 17px;
        font-weight: bold;
        display: none;
        z-index: 5;
    }

    /* COMMENTS */
    #commentsBox {
        position: fixed;
        bottom: 150px;
        left: 20px;
        width: 80%;
        z-index: 5;
        display: flex;
        flex-direction: column-reverse;
        gap: 12px;
        font-size: 22px;
        line-height: 24px;
        font-weight: 500;
        text-shadow: 0px 0px 4px black;
    }

    /* BOTTOM ICONS */
    #bottomBar {
        position: fixed;
        bottom: 40px;
        width: 100%;
        z-index: 5;
        display: flex;
        justify-content: center;
        gap: 80px;
        align-items: center;
    }
    .btn {
        background: none;
        border: none;
        padding: 0;
    }
    .iconImg {
        height: 48px;   /* ProporciÃ³n real usuario */
    }
    #recIcon { height: 46px; }
    #camIcon { height: 50px; }
    #heartIcon { height: 48px; }
</style>
</head>

<body>

<!-- VIDEO -->
<video id="video" autoplay playsinline muted></video>

<!-- TOP USER -->
<div id="topBox">
    <div id="userRow">
        <img id="kalalIcon" src="icons/KALAL.png">
        <div id="userName">KALAL_Y</div>
    </div>

    <div id="viewersRow">
        <img id="eyeIcon" src="icons/EYE.png">
        <div id="viewersText">50,604 viewers</div>
    </div>
</div>

<!-- LIVE BADGE -->
<div id="liveBadge">LIVE STREAMING</div>

<!-- COMMENTS -->
<div id="commentsBox"></div>

<!-- BOTTOM ICONS -->
<div id="bottomBar">
    <button id="recBtn" class="btn">
        <img id="recIcon" class="iconImg" src="icons/REC.png">
    </button>

    <button id="camBtn" class="btn">
        <img id="camIcon" class="iconImg" src="icons/CAM.png">
    </button>

    <button id="likeBtn" class="btn">
        <img id="heartIcon" class="iconImg" src="icons/HEART.png">
    </button>
</div>

<script>
/* ==========================================================
   CAMERA
   ========================================================== */
let stream = null;
let usingFront = false;

async function startCamera() {
    if (stream) stream.getTracks().forEach(t => t.stop());

    stream = await navigator.mediaDevices.getUserMedia({
        video: {
            facingMode: usingFront ? "user" : "environment",
            width: { ideal: 1920 },
            height: { ideal: 1080 }
        },
        audio: {
            echoCancellation: true,
            noiseSuppression: true
        }
    });

    video.srcObject = stream;
}
startCamera();

document.getElementById("camBtn").onclick = () => {
    usingFront = !usingFront;
    startCamera();
};

/* ==========================================================
   VIEWERS AUTO INCREASE
   ========================================================== */
let viewers = 50604;
setInterval(() => {
    viewers = Math.floor(viewers * 1.015);
    document.getElementById("viewersText").textContent =
        viewers.toLocaleString() + " viewers";
}, 2000);

/* ==========================================================
   COMMENTS
   ========================================================== */
const names = ["ÙÙ‡Ø¯", "Ø³ÙŠÙ", "ÙƒØ±ÙŠÙ…", "Ù†ÙˆØ±", "Ù…Ø±ÙˆØ§Ù†", "Ø¢Ø¯Ù…", "Ù„ÙŠÙ„Ù‰", "Ø³Ø§Ø±Ø©", "Ø¹Ù„ÙŠ", "ÙŠØ§Ø³ÙŠÙ†"];
const msgs = ["Ø¬ÙŠØ¯ Ø¬Ø¯Ù‹Ø§", "Ø£Ø­Ø³Ù†Øª", "Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²", "Ø¬Ù…ÙŠÙ„ Ø¬Ø¯Ù‹Ø§", "Ø§Ø³ØªÙ…Ø±", "Ø±Ø§Ø¦Ø¹"];

function randomComment() {
    const name = names[Math.floor(Math.random() * names.length)];
    const msg = msgs[Math.floor(Math.random() * msgs.length)];

    // Solo algunos llevan emoji
    const maybeEmoji = Math.random() < 0.45 ? (Math.random() < 0.5 ? " ğŸ‘" : " ğŸ”¥") : "";

    return `${name}: ${msg}${maybeEmoji}`;
}

function addComment() {
    const div = document.createElement("div");
    div.textContent = randomComment();
    commentsBox.appendChild(div);

    if (commentsBox.children.length > 5) {
        commentsBox.removeChild(commentsBox.children[0]);
    }
}

/* MÃ¡s lento: cada ~3.5 s */
setInterval(addComment, 3500);

/* ==========================================================
   RECORD
   ========================================================== */
let recorder = null;
let chunks = [];
let recording = false;
let blink = true;

recBtn.onclick = () => {
    if (!recording) startRecording();
    else stopRecording();
};

function blinkLive() {
    if (!recording) return;
    liveBadge.style.display = blink ? "block" : "none";
    blink = !blink;
    setTimeout(blinkLive, 900);  // parpadeo lento
}

function startRecording() {
    recording = true;
    liveBadge.style.display = "block";

    const canvas = new OffscreenCanvas(video.videoWidth, video.videoHeight);
    const ctx = canvas.getContext("2d");

    function drawFrame() {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        requestAnimationFrame(drawFrame);
    }
    drawFrame();

    const streamCanvas = canvas.captureStream(30);

    recorder = new MediaRecorder(streamCanvas, { mimeType: "video/webm" });
    chunks = [];

    recorder.ondataavailable = e => { if (e.data.size > 0) chunks.push(e.data); };

    recorder.onstop = () => {
        const blob = new Blob(chunks, { type: "video/webm" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "live.mp4";
        a.click();
        URL.revokeObjectURL(url);
    };

    recorder.start();
    blinkLive();
}

function stopRecording() {
    recording = false;
    liveBadge.style.display = "none";
    recorder.stop();
}
</script>

</body>
</html>
